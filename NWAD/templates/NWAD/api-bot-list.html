{% extends './base.html' %}

{% load static %}

{% block contents %}
<div class="d-flex flex-column flex-column-fluid container-fluid">
    <!--begin::Toolbar-->
    <div class="toolbar mb-5 mb-lg-7" id="kt_toolbar">
        <!--begin::Page title-->
        <div class="page-title d-flex flex-column me-3">
            <!--begin::Title-->
            <h1 class="d-flex text-dark fw-bold my-1 fs-3">API/Bot List</h1>
            <!--end::Title-->
            <!--begin::Breadcrumb-->
            <ul class="breadcrumb breadcrumb-line fw-semibold text-muted fs-7 my-1">
                <!--begin::Item-->
                <li class="breadcrumb-item pe-3">
                    <span class="pe-3">Home</span>
                </li>
                <!--end::Item-->
                <!--begin::Item-->
                <li class="breadcrumb-item pe-3">
                    <span class="pe-3">SERVICES</span></li>
                <!--end::Item-->
                <!--begin::Item-->
                <li class="breadcrumb-item pe-3">
                    <span class="text-gray-600 pe-3">API List</span>
                </li>
                <!--end::Item-->
            </ul>
            <!--end::Breadcrumb-->
        </div>
        <!--end::Page title-->
    </div>
    <!--end::Toolbar-->
    <!--begin::Post-->
    <div class="content flex-column-fluid" id="kt_content">
        <!--begin:: Bot Mesaage Box-->
        <div class="card shadow-sm mb-6" 
             data-kt-sticky="true"
             data-kt-sticky-name="docs-sticky-summary"
             data-kt-sticky-offset="{default: false, xl: '100px'}"
             data-kt-sticky-width="{lg: '250px', xl: {target: '#kt_content'}}"
             data-kt-sticky-left="auto"
             data-kt-sticky-top="70px"
             data-kt-sticky-animation="true"
             data-kt-sticky-zindex="95">
            <div class="card-body">
                <div class="d-flex flex-row justify-content-between align-items-center g-3">
                    <div class="d-flex">
                        <div class="d-flex fs-3 fw-bold me-8">선택항목</div>
                        <div class="d-flex align-items-center me-4"><span class="badge badge-outline badge-primary me-3">API</span><span class="fs-4 fw-bold" id="selectApiName"></span></div>
                        <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/arrows/arr075.svg-->
                        <span class="svg-icon svg-icon-primary svg-icon-2x me-4"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1" transform="rotate(-90 11.364 20.364)" fill="currentColor" />
                            <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />
                            </svg></span>
                        <!--end::Svg Icon-->
                        <div class="d-flex align-items-center me-4"><span class="badge badge-outline badge-success me-3">Bot</span><span class="fs-4 fw-bold" id="selectBotName"></span></div>
                    </div>
                    <div class="d-flex justify-content-end align-items-center">
                        <button type="button" class="btn btn-sm btn-icon btn-bg-light btn-active-light-primary me-5"   data-bs-toggle="tooltip" data-bs-placement="top" title="선택초기화" onclick="fn_cancleSelect();">
                        <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/arrows/arr029.svg-->
                        <span class="svg-icon  svg-icon-muted svg-icon-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14.5 20.7259C14.6 21.2259 14.2 21.826 13.7 21.926C13.2 22.026 12.6 22.0259 12.1 22.0259C9.5 22.0259 6.9 21.0259 5 19.1259C1.4 15.5259 1.09998 9.72592 4.29998 5.82592L5.70001 7.22595C3.30001 10.3259 3.59999 14.8259 6.39999 17.7259C8.19999 19.5259 10.8 20.426 13.4 19.926C13.9 19.826 14.4 20.2259 14.5 20.7259ZM18.4 16.8259L19.8 18.2259C22.9 14.3259 22.7 8.52593 19 4.92593C16.7 2.62593 13.5 1.62594 10.3 2.12594C9.79998 2.22594 9.4 2.72595 9.5 3.22595C9.6 3.72595 10.1 4.12594 10.6 4.02594C13.1 3.62594 15.7 4.42595 17.6 6.22595C20.5 9.22595 20.7 13.7259 18.4 16.8259Z" fill="currentColor"/>
                            <path opacity="0.3" d="M2 3.62592H7C7.6 3.62592 8 4.02592 8 4.62592V9.62589L2 3.62592ZM16 14.4259V19.4259C16 20.0259 16.4 20.4259 17 20.4259H22L16 14.4259Z" fill="currentColor"/>
                            </svg>
                        </span>
                        <!--end::Svg Icon-->
                        </button>
                        <a href="#" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#modal_bot_message_confirm">Bot Message 전달</a>
                </div>
                </div>
            </div>
        </div>
        <!--end:: Bot Message Box-->
        <!--begin:: Api List Box-->
        <div class="card">
            <div class="card-header py-3">
                <div class="card-title">
                    <h3 class="fs-2 fw-bold my-2">API List
                        <span class="fs-6 text-gray-400 fw-semibold ms-1">총 <span id="spanApiCount"></span>개</span>
                    </h3>
                </div>
                <div class="card-toolbar">
                    <a href="#" class="btn btn-primary fw-bolder d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modal_api_list_add">
                        <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/arrows/arr075.svg-->
                        <span class="svg-icon svg-icon-primary svg-icon-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1" transform="rotate(-90 11.364 20.364)" fill="currentColor" />
                            <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />
                            </svg></span>
                        <!--end::Svg Icon-->
                        추가하기
                    </a>
                </div>
            </div>
            <!--begin::card body-->
            <div class="card-body">
            <!--begin::Input group-->
            <div class="fv-row row g-6 mb-3 mh-350px scroll-y" data-kt-buttons="true" id="apiList">
            </div>
            <!--end::Input group-->
            </div>
            <!--end::card body-->
        </div>
        <!--end:: Api List Box-->
        <!--begin:: Bot List Box-->
        <div class="card mt-10">
            <div class="card-header py-3">
                <div class="card-title">
                    <h3 class="fs-2 fw-bold my-2">Bot List
                        <span class="fs-6 text-gray-400 fw-semibold ms-1">총 <span id="spanBotCount"></span>개</span>
                    </h3>
                </div>
                <div class="card-toolbar">
                    <a href="#" class="btn btn-success fw-bolder d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modal_bot_list_add">
                        <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/arrows/arr075.svg-->
                        <span class="svg-icon svg-icon-primary svg-icon-1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1" transform="rotate(-90 11.364 20.364)" fill="currentColor" />
                            <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />
                            </svg></span>
                        <!--end::Svg Icon-->
                        추가하기
                    </a>
                </div>
            </div>
            <div class="card-body">
            <!--begin::Input group-->
            <div class="fv-row row g-6 mb-3 mh-350px scroll-y" data-kt-buttons="true" id="botList">
            </div>
            <!--end::Input group-->
            </div>
        </div>
        <!--end:: Bot List Box-->
    </div>
    <!--end::Post-->
    <!--begin::Footer-->
    <div class="footer py-4 d-flex flex-column flex-md-row flex-stack" id="kt_footer">
        <!--begin::Copyright-->
        <div class="text-gray-600 order-2 order-md-1">
            <span class="text-muted fw-semibold me-1">2022&copy;</span>
            <a href="https://didim365.com" target="_blank" class="text-gray-800 text-hover-primary">Didim365</a>
        </div>
        <!--end::Copyright-->
        <!--begin::Menu-->
        <ul class="menu menu-gray-600 menu-hover-primary fw-semibold order-1">
            <li class="menu-item">
                <a href="#" target="_blank" class="menu-link px-2">이용약관</a>
            </li>
            <li class="menu-item">
                <a href="#" target="_blank" class="menu-link px-2">개인정보처리방침</a>
            </li>
        </ul>
        <!--end::Menu-->
    </div>
    <!--end::Footer-->
</div>
{% endblock %}

{% block modals %}
<!--begin::Modal - Api List Add-->
<div class="modal fade" id="modal_api_list_add" tabindex="-1" aria-hidden="true">
    <!--begin::Modal dialog-->
    <div class="modal-dialog modal-dialog-centered mw-650px">
        <!--begin::Modal content-->
        <div class="modal-content">
            <!--begin::Modal header-->
            <div class="modal-header" id="modal_api_list_add_header">
                <!--begin::Modal title-->
                <h2>API 추가하기</h2>
                <!--end::Modal title-->
                <!--begin::Close-->
                <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                    <span class="svg-icon svg-icon-1">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                            <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->
                </div>
                <!--end::Close-->
            </div>
            <!--end::Modal header-->
            <!--begin::Form-->
            <form id="modal_api_list_add_form" class="form" action="#">
                {% csrf_token %}
                <!--begin::Modal body-->
                <div class="modal-body py-10 px-lg-17">
                    <!--begin::Scroll-->
                    <div class="scroll-y me-n7 pe-7" id="modal_api_list_add_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#modal_api_list_add_header" data-kt-scroll-wrappers="#modal_api_list_add_scroll" data-kt-scroll-offset="300px">
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">API 이름</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="API 이름 입력" name="api_name" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Client ID</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Client ID 입력" name="client_id" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Client Secret</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Client Secret 입력" name="client_secret" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Service Account</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Service Account 입력" name="service_account" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="d-flex flex-column mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Private Key</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <textarea class="form-control form-control-solid" rows="3" name="private_key" placeholder="Private Key 입력"></textarea>
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Scope</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input class="form-control form-control-solid" name="scope_tags" id="kt_tagify_2" />
                            <!--end::Input-->
                            <div class="fs-7 fw-semibold text-muted mt-2">엔터로 구분</div>
                        </div>
                        <!--end::Input group-->
                    </div>
                    <!--end::Scroll-->
                </div>
                <!--end::Modal body-->
                <!--begin::Modal footer-->
                <div class="modal-footer flex-center">
                    <!--begin::Button-->
                    <button type="reset" id="modal_api_list_add_cancel" class="btn btn-light me-3">취소</button>
                    <!--end::Button-->
                    <!--begin::Button-->
                    <button type="button" id="modal_api_list_add_submit" class="btn btn-primary">
                        <span class="indicator-label">추가</span>
                        <span class="indicator-progress">처리중 ...
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                    <!--end::Button-->
                </div>
                <!--end::Modal footer-->
            </form>
            <!--end::Form-->
        </div>
        <!--end::Modal content-->
    </div>
    <!--end::Modal dialog-->
</div>
<!--end::Modal - Api List Add-->

<!--begin::Modal - API list-->
<div class="modal fade" id="modal-api-list" tabindex="-1" aria-hidden="true">
    <!--begin::Modal dialog-->
    <div class="modal-dialog modal-dialog-centered mw-650px">
        <!--begin::Modal content-->
        <div class="modal-content">
            <!--begin::Modal header-->
            <div class="modal-header" id="modal-api-list_header">
                <!--begin::Modal title-->
                <h2>API 정보 보기</h2>
                <!--end::Modal title-->
                <!--begin::Close-->
                <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                    <span class="svg-icon svg-icon-1">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                            <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->
                </div>
                <!--end::Close-->
            </div>
            <!--end::Modal header-->
            <!--begin::Form-->
            <form id="modal-api-list_form" class="form" action="#">
                {% csrf_token %}
                <input type="hidden" name="api_no">
                <!--begin::Modal body-->
                <div class="modal-body py-10 px-lg-17">
                    <!--begin::Scroll-->
                    <div class="scroll-y me-n7 pe-7" id="modal-api-list_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#modal-api-list_header" data-kt-scroll-wrappers="#modal-api-list_scroll" data-kt-scroll-offset="300px">
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">API 이름</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="API 이름 입력" name="api_name" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Client ID</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Client ID 입력" name="client_id" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Client Secret</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Client Secret 입력" name="client_secret" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Service Account</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Service Account 입력" name="service_account" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="d-flex flex-column mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Private Key</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <textarea class="form-control form-control-solid" rows="3" name="private_key" placeholder="Private Key 입력">
                            </textarea>
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Scope</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input class="form-control form-control-solid" name="scope_tags" id="kt_tagify_3" />
                            <!--end::Input-->
                            <div class="fs-7 fw-semibold text-muted mt-2">엔터로 구분</div>
                        </div>
                        <!--end::Input group-->
                    </div>
                    <!--end::Scroll-->
                </div>
                <!--end::Modal body-->
                <!--begin::Modal footer-->
                <div class="modal-footer flex-center">
                    <!--begin::Button-->
                    <button type="reset" id="modal-api-list_cancel" class="btn btn-light me-3">취소</button>
                    <!--end::Button-->
                    <!--begin::Button-->
                    <button type="button" id="modal-api-list_submit" class="btn btn-primary">
                        <span class="indicator-label">저장</span>
                        <span class="indicator-progress">처리중 ...
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                    <!--end::Button-->
                </div>
                <!--end::Modal footer-->
            </form>
            <!--end::Form-->
        </div>
        <!--end::Modal content-->
    </div>
    <!--end::Modal dialog-->
</div>
<!--end::Modal - API List-->

<!--begin::Modal - Bot List Add-->
<div class="modal fade" id="modal_bot_list_add" tabindex="-1" aria-hidden="true">
    <!--begin::Modal dialog-->
    <div class="modal-dialog modal-dialog-centered mw-650px">
        <!--begin::Modal content-->
        <div class="modal-content">
            <!--begin::Modal header-->
            <div class="modal-header" id="modal_bot_list_add_header">
                <!--begin::Modal title-->
                <h2>Bot 추가하기</h2>
                <!--end::Modal title-->
                <!--begin::Close-->
                <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                    <span class="svg-icon svg-icon-1">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                            <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->
                </div>
                <!--end::Close-->
            </div>
            <!--end::Modal header-->
            <!--begin::Form-->
            <form id="modal_bot_list_add_form" class="form" action="#">
                {% csrf_token %}
                <!--begin::Modal body-->
                <div class="modal-body py-10 px-lg-17">
                    <!--begin::Scroll-->
                    <div class="scroll-y me-n7 pe-7" id="modal_bot_list_add_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#modal_bot_list_add_header" data-kt-scroll-wrappers="#modal_bot_list_add_scroll" data-kt-scroll-offset="300px">
                        <!--begin::Input group-->
                        <div class="d-flex flex-column mb-5 fv-row fv-plugins-icon-container" data-select2-id="select2">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">API <span class="fs-7 fw-semibold text-gray-400 mb-1">(Bot 인증에 사용됩니다.)</span></label>
                            <!--end::Label-->
                            <!--begin::Select-->
                            <select class="form-select form-select-solid" name="api_no" data-control="select2" data-hide-search="true" data-placeholder="API 선택하기">
                                <option></option>
                            </select>
                            <!--end::Select-->
                            <div class="fv-plugins-message-container invalid-feedback"></div>
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Bot ID</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Bot ID 입력" name="bot_id" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->

                        <!--begin::Input group-->
                        <div class="d-flex flex-column mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Bot Secret</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <textarea class="form-control form-control-solid" rows="3" name="bot_secret" placeholder="Bot Secret 입력"></textarea>
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                    </div>
                    <!--end::Scroll-->
                </div>
                <!--end::Modal body-->
                <!--begin::Modal footer-->
                <div class="modal-footer flex-center">
                    <!--begin::Button-->
                    <button type="reset" id="modal_bot_list_add_cancel" class="btn btn-light me-3">취소</button>
                    <!--end::Button-->
                    <!--begin::Button-->
                    <button type="submit" id="modal_bot_list_add_submit" class="btn btn-primary">
                        <span class="indicator-label">추가</span>
                        <span class="indicator-progress">처리중 ...
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                    <!--end::Button-->
                </div>
                <!--end::Modal footer-->
            </form>
            <!--end::Form-->
        </div>
        <!--end::Modal content-->
    </div>
    <!--end::Modal dialog-->
</div>
<!--end::Modal - Bot List Add-->

<!--begin::Modal - Bot List-->
<div class="modal fade" id="modal_bot_list" tabindex="-1" aria-hidden="true">
    <!--begin::Modal dialog-->
    <div class="modal-dialog modal-dialog-centered mw-650px">
        <!--begin::Modal content-->
        <div class="modal-content">
            <!--begin::Modal header-->
            <div class="modal-header" id="modal_bot_list_header">
                <!--begin::Modal title-->
                <h2>Bot 정보 보기</h2>
                <!--end::Modal title-->
                <!--begin::Close-->
                <div class="btn btn-sm btn-icon btn-active-color-primary" data-bs-dismiss="modal">
                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                    <span class="svg-icon svg-icon-1">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="currentColor" />
                            <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="currentColor" />
                        </svg>
                    </span>
                    <!--end::Svg Icon-->
                </div>
                <!--end::Close-->
            </div>
            <!--end::Modal header-->
            <!--begin::Form-->
            <form id="modal_bot_list_form" class="form" action="#">
                {% csrf_token %}
                <input type="hidden" name="bot_no">
                <!--begin::Modal body-->
                <div class="modal-body py-10 px-lg-17">
                    <!--begin::Scroll-->
                    <div class="scroll-y me-n7 pe-7" id="modal_bot_list_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#modal_bot_list_header" data-kt-scroll-wrappers="#modal_bot_list_scroll" data-kt-scroll-offset="300px">
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Bot 이름</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input type="text" class="form-control form-control-solid" placeholder="Bot 이름 입력" name="bot_name" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="d-flex flex-column mb-5 fv-row fv-plugins-icon-container" data-select2-id="select2">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">API <span class="fs-7 fw-semibold text-gray-400 mb-1">(Bot 인증에 사용됩니다.)</span></label>
                            <!--end::Label-->
                            <!--begin::Select-->
                            <select class="form-select form-select-solid" name="api_no" data-control="select2"  data-hide-search="true" data-placeholder="API 선택하기">
                            </select>
                            <!--end::Select-->
                            <div class="fv-plugins-message-container invalid-feedback"></div>
                        </div>
                        <!--end::Input group-->
                        <!--begin::Input group-->
                        <div class="mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Bot ID</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <input value="" type="text" class="form-control form-control-solid" placeholder="Bot ID 입력" name="bot_id" />
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->

                        <!--begin::Input group-->
                        <div class="d-flex flex-column mb-5 fv-row">
                            <!--begin::Label-->
                            <label class="required fs-5 fw-semibold mb-2">Bot Secret</label>
                            <!--end::Label-->
                            <!--begin::Input-->
                            <textarea class="form-control form-control-solid" rows="3" name="bot_secret" placeholder="Bot Secret 입력"></textarea>
                            <!--end::Input-->
                        </div>
                        <!--end::Input group-->
                    </div>
                    <!--end::Scroll-->
                </div>
                <!--end::Modal body-->
                <!--begin::Modal footer-->
                <div class="modal-footer flex-center">
                    <!--begin::Button-->
                    <button type="reset" id="modal_bot_list_cancel" class="btn btn-light me-3">취소</button>
                    <!--end::Button-->
                    <!--begin::Button-->
                    <button type="submit" id="modal_bot_list_submit" class="btn btn-primary">
                        <span class="indicator-label">저장</span>
                        <span class="indicator-progress">처리중 ...
                            <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                    </button>
                    <!--end::Button-->
                </div>
                <!--end::Modal footer-->
            </form>
            <!--end::Form-->
        </div>
        <!--end::Modal content-->
    </div>
    <!--end::Modal dialog-->
</div>
<!--end::Modal - Bot List-->

<!--begin::Modal - Bot Message Confirm-->
<div class="modal fade" id="modal_bot_message_confirm" tabindex="-1" style="display: none;" aria-hidden="true">
    <!--begin::Modal dialog-->
    <div class="modal-dialog modal-dialog-centered mw-650px">
        <!--begin::Modal content-->
        <div class="modal-content">
            <form action="./botMessage" method="get" id="formBotMessage">
                <input type="hidden" name="api_no">
                <input type="hidden" name="bot_no">
                <!--begin::Modal header-->
                <div class="modal-header" id="modal_bot_message_confirm_header">
                    <!--begin::Modal title-->
                    <div class="fs-3 fw-bold">해당내용을 Bot Message로 전달할까요?</div>
                    <!--end::Modal title-->
                </div>
                <!--end::Modal header-->
                <!--begin::Modal body-->
                <div class="modal-body py-10 px-lg-17">
                    <!--begin::Scroll-->
                    <div class="scroll-y me-n7 pe-7" id="modal_bot_message_confirm_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#modal_bot_message_confirm_header" data-kt-scroll-wrappers="#modal_bot_message_confirm_scroll" data-kt-scroll-offset="300px" style="max-height: 934px;">
                        <div class="row">
                            <!--begin::Col-->
                            <div class="col-md-6 col-lg-4 col-xl-6">
                                <!--begin::Card-->
                                <div class="card h-100">
                                    <!--begin::Card body-->
                                    <div class="card-body rounded bg-light-primary border border-primary d-flex justify-content-center text-left flex-column px-5 py-4">
                                        <!--begin::Title-->
                                        <div class="text-gray-800 fs-4 fw-bold mb-3 api-name">API 1 Test</div>
                                        <!--end::Title-->
                                        <!--begin::Description-->
                                        <div class="fs-7 fw-semibold text-gray-400 mb-1">Client ID</div>
                                        <div class="fs-6 fw-semibold text-gray-700 client-id">eoX5oR3RZhCeoX5oR3RZhC</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Card body-->
                                </div>
                                <!--end::Card-->
                            </div>
                            <!--end::Col-->
                            <!--begin::Col-->
                            <div class="col-md-6 col-lg-4 col-xl-6">
                                <!--begin::Card-->
                                <div class="card h-100">
                                    <!--begin::Card body-->
                                    <div class="card-body rounded bg-light-success border border-success d-flex justify-content-center text-left flex-column px-5 py-4">
                                        <!--begin::Title-->
                                        <div class="text-gray-800 fs-4 fw-bold mb-3 bot-name">Bot 1 Test</div>
                                        <!--end::Title-->
                                        <!--begin::Description-->
                                        <div class="fs-7 fw-semibold text-gray-400 mb-1">Bot ID</div>
                                        <div class="fs-6 fw-semibold text-gray-700 bot-id">eoX5oR3RZhCeoX5oR3RZhC</div>
                                        <!--end::Description-->
                                    </div>
                                    <!--end::Card body-->
                                </div>
                                <!--end::Card-->
                            </div>
                            <!--end::Col-->
                        </div>
                    </div>
                    <!--end::Scroll-->
                </div>
                <!--end::Modal body-->
                <!--begin::Modal footer-->
                <div class="modal-footer flex-center">
                    <!--begin::Button-->
                    <button type="reset" id="modal_bot_message_confirm_cancel" class="btn btn-light me-3">다시 선택</button>
                    <!--end::Button-->
                    <!--begin::Button-->
                    <button type="submit" id="modal_bot_message_confirm_submit" class="btn btn-primary">
                        <span class="indicator-label">전달하기</span>
                    </button>
                    <!--end::Button-->
                </div>
                <!--end::Modal footer-->
            </form>
        </div>
        <!--end::Modal content-->
    </div>
    <!--end::Modal dialog-->
</div>
<!--end::Modal - Bot Message Confirm-->
{% endblock %}

{% block scripts %}
<script>
    window.addEventListener('load',function(){
        fn_getApiList();
        fn_getBotList();

        document.getElementById('modal_api_list_add').addEventListener('hide.bs.modal',(e)=>{
            fn_getApiList();
        });
        document.getElementById('modal-api-list').addEventListener('show.bs.modal',(e)=>{
            fn_getApiInfo();
        });
        document.getElementById('modal-api-list').addEventListener('hide.bs.modal',(e)=>{
            fn_getApiList();
        });
        document.getElementById('modal_bot_list_add').addEventListener('show.bs.modal',(e)=>{
            fn_getBotApiList();
        });
        document.getElementById('modal_bot_list_add').addEventListener('hide.bs.modal',(e)=>{
            fn_getBotList();
        });
        document.getElementById('modal_bot_list').addEventListener('show.bs.modal',(e)=>{
            fn_getBotInfo();
        });
        document.getElementById('modal_bot_list').addEventListener('hide.bs.modal',(e)=>{
            fn_getBotList();
        });
        document.getElementById('modal_bot_message_confirm').addEventListener('show.bs.modal',(e)=>{
            fn_setBtoMessageData();
        });
    });
    
    var fn_getApiList = function() {
        let url = "api/getApiList";
        let formData = new FormData();
        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));

        fetch(url, {
            method: "POST",
            cache: 'no-cache',
            body: formData,
        }).then((response) => {
            if (!response.ok || response.status != '200') {
                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
            }
            return response.json();
        }).then((res) => {
            fn_apiDrawTable(res);
            fn_apiAddEvent();
            KTComponents.init();
        }).catch((err) => {
            Swal.fire({
                text: err,
                icon: "error",
                buttonsStyling: false,
                confirmButtonText: "다시 확인하기",
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            });
        });
    }
    
    var fn_getApiInfo = function() {
        let url = "api/getApi";
        let formData = new FormData();
        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));
        formData.append("api_no",document.querySelector('input[name=api_select]:checked').closest('label').dataset.apiNo);

        fetch(url, {
            method: "POST",
            cache: 'no-cache',
            body: formData,
        }).then((response) => {
            if (!response.ok || response.status != '200') {
                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
            }
            return response.json();
        }).then((res) => {
            let form = document.getElementById('modal-api-list');
            form.querySelector('input[name=api_no]').value = res.data.data[0].api_no;
            form.querySelector('input[name=api_name]').value = res.data.data[0].api_name;
            form.querySelector('input[name=client_id]').value = res.data.data[0].client_id;
            form.querySelector('input[name=client_secret]').value = res.data.data[0].client_secret;
            form.querySelector('input[name=service_account]').value = res.data.data[0].service_account;
            form.querySelector('textarea[name=private_key]').value = res.data.data[0].private_key;
            form.querySelector('input[name=scope_tags]').value = res.data.data[0].scope;
            
        }).catch((err) => {
            Swal.fire({
                text: err,
                icon: "error",
                buttonsStyling: false,
                confirmButtonText: "확인",
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            }).then(function (result) {
                if (result.isConfirmed) {
                    modalClose();
                }
            });
        });
    }
      
    var fn_getBotList = function() {
        let url = "bot/getBotList";
        let formData = new FormData();
        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));

        fetch(url, {
            method: "POST",
            cache: 'no-cache',
            body: formData,
        }).then((response) => {
            if (!response.ok || response.status != '200') {
                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
            }
            return response.json();
        }).then((res) => {
            fn_botDrawTable(res);
            fn_botAddEvent();
            KTComponents.init();
        }).catch((err) => {
            Swal.fire({
                text: err,
                icon: "error",
                buttonsStyling: false,
                confirmButtonText: "다시 확인하기",
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            });
        });
    }
    
    var fn_getBotInfo = function() {
        let url = "bot/getBot";
        let formData = new FormData();
        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));
        formData.append("bot_no",document.querySelector('input[name=bot-check]:checked').closest('label').dataset.botNo);

        fetch(url, {
            method: "POST",
            cache: 'no-cache',
            body: formData,
        }).then((response) => {
            if (!response.ok || response.status != '200') {
                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
            }
            return response.json();
        }).then((res) => {
            let form = document.getElementById('modal_bot_list');
            form.querySelector('input[name=bot_no]').value = res.data.data[0].bot_no;
            form.querySelector('input[name=bot_name]').value = res.data.data[0].bot_name;
            form.querySelector('input[name=bot_id]').value = res.data.data[0].bot_id;
            form.querySelector('textarea[name=bot_secret]').value = res.data.data[0].bot_secret;

            form.querySelector('select[name=api_no]').innerHTML = "<option value=''></option>";
            for(let i = 0; i < res.apis.data.length; i++){
                let option = `<option value="` + res.apis.data[i].api_no + `">` + res.apis.data[i].api_name + `</option>`;
                form.querySelector('select[name=api_no]').innerHTML += option;
            }
            
        }).catch((err) => {
            Swal.fire({
                text: err,
                icon: "error",
                buttonsStyling: false,
                confirmButtonText: "확인",
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            }).then(function (result) {
                if (result.isConfirmed) {
                    modalClose();
                }
            });
        });
    }

    var fn_getBotApiList = function() {
        let url = "api/getApiList";
        let formData = new FormData();
        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));

        fetch(url, {
            method: "POST",
            cache: 'no-cache',
            body: formData,
        }).then((response) => {
            if (!response.ok || response.status != '200') {
                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
            }
            return response.json();
        }).then((res) => {
            let form = document.getElementById('modal_bot_list_add');
            form.querySelector('select[name=api_no]').innerHTML = "<option value=''></option>";
            for(let i = 0; i < res.data.length; i++){
                let option = `<option value="` + res.data[i].api_no + `">` + res.data[i].api_name + `</option>`;
                form.querySelector('select[name=api_no]').innerHTML += option;
            }
        }).catch((err) => {
            Swal.fire({
                text: err,
                icon: "error",
                buttonsStyling: false,
                confirmButtonText: "다시 확인하기",
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            });
        });
    }

    var fn_apiDrawTable = function(data) {
        document.getElementById("spanApiCount").innerHTML = data.data.length;
        var apiList = document.getElementById("apiList");
        apiList.innerHTML = "";
        let html = ``;
        for(let i = 0; i < data.data.length; i++){
            html = ``;
            html += `<!--begin::Option-->`;
            html += `<div class="col-md-6 col-lg-4 col-xl-3 ">`;
            html += `    <label class="h-100 btn btn-custom btn-active-light-primary border border-gray-300 border-dashed border-active-primary position-relative d-flex flex-column text-start p-6"  data-api-no="` + data.data[i].api_no + `">`;
            html += `        <div class="d-flex align-items-center flex-stack mb-1">`;
            html += `            <!--begin::Radio Field-->`;
            html += `            <div class="form-check form-check-custom form-check-solid form-check-primary me-6">`;
            html += `                <input class="form-check-input" type="radio" name="api_select" value="` + i + `">`;
            html += `            </div>`;
            html += `            <!--end::Radio Field-->`;
            html += `            <!--begin::Edit button-->`;
            html += `            <div class="me-n2">`;
            html += `                <button type="button" class="btn btn-sm btn-icon btn-color-primary btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">`;
            html += `                    <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/general/gen052.svg-->`;
            html += `                    <span class="svg-icon svg-icon-2x"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">`;
            html += `                        <rect x="10" y="10" width="4" height="4" rx="2" fill="currentColor"/>`;
            html += `                        <rect x="17" y="10" width="4" height="4" rx="2" fill="currentColor"/>`;
            html += `                        <rect x="3" y="10" width="4" height="4" rx="2" fill="currentColor"/>`;
            html += `                        </svg>`;
            html += `                    </span>`;
            html += `                    <!--end::Svg Icon-->`;
            html += `                </button>`;
            html += `                <!--begin::Menu 3-->`;
            html += `                <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-100px py-3" data-kt-menu="true">`;
            html += `                    <!--begin::Menu item-->`;
            html += `                    <div class="menu-item px-3">`;
            html += `                        <a href="#" class="menu-link px-3" data-bs-toggle="modal" data-bs-target="#modal-api-list">수정하기</a>`;
            html += `                    </div>`;
            html += `                    <!--end::Menu item-->`;
            html += `                    <!--begin::Menu item-->`;
            html += `                    <div class="menu-item px-3">`;
            html += `                        <a href="#" class="menu-link px-3" data-action="btn-api-delete">삭제하기</a>`;
            html += `                    </div>`;
            html += `                    <!--end::Menu item-->`;
            html += `                </div>`;
            html += `                <!--end::Menu 3-->`;
            html += `            </div>`;
            html += `            <!--end::Edit button-->`;
            html += `        </div>`;
            html += `        <!--begin::Title-->`;
            html += `        <div class="text-gray-800 fs-4 fw-bold mb-3 api-name">` + data.data[i].api_name + `</div>`;
            html += `        <!--end::Title-->`;
            html += `        <!--begin::Description-->`;
            html += `        <div class="fs-7 fw-semibold text-gray-400 mb-1">Client ID</div>`;
            html += `        <div class="fs-6 fw-semibold text-gray-700 client-id">` + data.data[i].client_id + `</div>`;
            html += `        <!--end::Description-->`;
            html += `    </label>`;
            html += `</div>`;
            html += `<!--end::Option-->`;
            apiList.innerHTML += html;
        }

        html = ``;
        html += `<!--begin::Col-->`;
        html += `<div class="col-md-6 col-lg-4 col-xl-3">`;
        html += `    <!--begin::Card-->`;
        html += `    <a href="#" class="card h-100 flex-center bg-light-primary border-primary border border-dashed p-8" data-bs-toggle="modal" data-bs-target="#modal_api_list_add">`;
        html += `        <!--begin::Image-->`;
        html += `        <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/arrows/arr075.svg-->`;
        html += `        <span class="svg-icon svg-icon-primary svg-icon-2hx"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">`;
        html += `            <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1" transform="rotate(-90 11.364 20.364)" fill="currentColor" />`;
        html += `            <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />`;
        html += `            </svg></span>`;
        html += `        <!--end::Svg Icon-->`;
        html += `        <!--end::Image-->`;
        html += `        <!--begin::Link-->`;
        html += `        <div class="text-primary fs-5 fw-bold mb-2">API 추가하기</div>`;
        html += `        <!--end::Link-->`;
        html += `        <!--begin::Description-->`;
        html += `        <div class="fs-7 fw-semibold text-gray-400">클릭하여 API 추가하세요</div>`;
        html += `        <!--end::Description-->`;
        html += `    </a>`;
        html += `    <!--end::Card-->`;
        html += `</div>`;
        html += `<!--end::Col-->`;
        apiList.innerHTML += html;
    }
    
    var fn_botDrawTable = function(data) {
        document.getElementById("spanBotCount").innerHTML = data.data.length;
        var botList = document.getElementById("botList");
        botList.innerHTML = "";
        let html = ``;
        for(let i = 0; i < data.data.length; i++){
            html = ``;
            html += `<!--begin::Option-->`;
            html += `<div class="col-md-6 col-lg-4 col-xl-3">`;
            html += `    <label class="h-100 btn btn-custom btn-active-light-success border border-gray-300 border-dashed border-active-success position-relative d-flex flex-column text-start p-6" data-bot-no="` + data.data[i].bot_no + `">`;
            html += `        <div class="d-flex align-items-center flex-stack mb-1">`;
            html += `            <!--begin::Check Field-->`;
            html += `            <div class="form-check form-check-sm form-check-custom form-check-solid bot-check">`;
            html += `                <input class="form-check-input" type="radio" value="` + i + `"  name="bot-check">`;
            html += `            </div>`;
            html += `            <!--end::Check Field-->`;
            html += `            <!--begin::Edit button-->`;
            html += `            <div class="me-n2">`;
            html += `                <button type="button" class="btn btn-sm btn-icon btn-color-success btn-active-light-success" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">`;
            html += `                    <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/general/gen052.svg-->`;
            html += `                    <span class="svg-icon svg-icon-2x"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">`;
            html += `                        <rect x="10" y="10" width="4" height="4" rx="2" fill="currentColor"/>`;
            html += `                        <rect x="17" y="10" width="4" height="4" rx="2" fill="currentColor"/>`;
            html += `                        <rect x="3" y="10" width="4" height="4" rx="2" fill="currentColor"/>`;
            html += `                        </svg>`;
            html += `                    </span>`;
            html += `                    <!--end::Svg Icon-->`;
            html += `                </button>`;
            html += `                <!--begin::Menu 3-->`;
            html += `                <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-100px py-3" data-kt-menu="true">`;
            html += `                    <!--begin::Menu item-->`;
            html += `                    <div class="menu-item px-3">`;
            html += `                        <a href="#" class="menu-link px-3" data-bs-toggle="modal" data-bs-target="#modal_bot_list">수정하기</a>`;
            html += `                    </div>`;
            html += `                    <!--end::Menu item-->`;
            html += `                    <!--begin::Menu item-->`;
            html += `                    <div class="menu-item px-3">`;
            html += `                        <a href="#" id="delete_alert" class="menu-link px-3" data-action="btn-bot-delete">삭제하기</a>`;
            html += `                    </div>`;
            html += `                    <!--end::Menu item-->`;
            html += `                </div>`;
            html += `                <!--end::Menu 3-->`;
            html += `            </div>`;
            html += `            <!--end::Edit button-->`;
            html += `        </div>`;
            html += `        <!--begin::Title-->`;
            html += `        <div class="text-gray-800 fs-4 fw-bold mb-3 bot-name">` + data.data[i].bot_name + `</div>`;
            html += `        <!--end::Title-->`;
            html += `        <!--begin::Description-->`;
            html += `        <div class="fs-7 fw-semibold text-gray-400 mb-1">Bot ID</div>`;
            html += `        <div class="fs-6 fw-semibold text-gray-700 bot-id">` + data.data[i].bot_id + `</div>`;
            html += `        <!--end::Description-->`;
            html += `    </label>`;
            html += `</div>`;
            html += `<!--end::Option-->`;
            botList.innerHTML += html;
        }

        html = ``;
        html += `<!--begin::Col-->`;
        html += `<div class="col-md-6 col-lg-4 col-xl-3">`;
        html += `    <!--begin::Card-->`;
        html += `    <a href="#" class="card h-100 flex-center bg-light-success border-success border border-dashed p-8" data-bs-toggle="modal" data-bs-target="#modal_bot_list_add">`;
        html += `        <!--begin::Image-->`;
        html += `        <!--begin::Svg Icon | path: /var/www/preview.keenthemes.com/kt-products/docs/metronic/html/releases/2022-11-29-094551/core/html/src/media/icons/duotune/arrows/arr075.svg-->`;
        html += `        <span class="svg-icon svg-icon-success svg-icon-2hx"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">`;
        html += `            <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1" transform="rotate(-90 11.364 20.364)" fill="currentColor" />`;
        html += `            <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />`;
        html += `            </svg></span>`;
        html += `        <!--end::Svg Icon-->`;
        html += `        <!--end::Image-->`;
        html += `        <!--begin::Link-->`;
        html += `        <div class="text-success fs-5 fw-bold mb-2">Bot 추가하기</div>`;
        html += `        <!--end::Link-->`;
        html += `        <!--begin::Description-->`;
        html += `        <div class="fs-7 fw-semibold text-gray-700">클릭하여 Bot 추가하세요</div>`;
        html += `        <!--end::Description-->`;
        html += `    </a>`;
        html += `    <!--end::Card-->`;
        html += `</div>`;
        html += `<!--end::Col-->`;
        botList.innerHTML += html;
    }

    var fn_apiAddEvent = function(e){
        let apis = document.querySelectorAll('#apiList label');
        for(let i = 0; i<apis.length; i++){
            apis[i].addEventListener('click',(e)=>{
                for(let j = 0; j<apis.length; j++){
                    apis[j].classList.remove('active');
                }
                document.getElementById("selectApiName").innerHTML = e.target.closest('label').querySelector('.api-name').innerHTML;
                e.target.closest('label').querySelector('input[name=api_select]').checked = true;
            });
            
            apis[i].querySelector('a[data-action=btn-api-delete]').addEventListener('click',(event)=>{
                Swal.fire({
                    html: '<strong class="fs-4">Bot 삭제 확인</strong><br /><span class="fs-6">선택하신 Bot 을 삭제하시겠습니까?</span>',
                    icon: "error",
                    buttonsStyling: false,
                    showCancelButton: true,
                    confirmButtonText: '<a class="text-white">삭제</a>',
                    cancelButtonText: '<a class="text-gray-500">취소</a>',
                    customClass: {
                        confirmButton: "btn btn-danger px-5 py-2",
                        cancelButton: "btn btn-light px-5 py-2"
                    }
                }).then(ev => {
                    if(ev.isConfirmed){
                        let url = "./api/apiRm";
                        let formData = new FormData();
                        formData.append("api_no", apis[i].dataset.apiNo);
                        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));

                        fetch(url, {
                            method: "POST",
                            cache: 'no-cache',
                            body: formData,
                        }).then((response) => {
                            if (!response.ok || response.status != '200') {
                                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
                            }
                        }).then((res) => {
                            fn_getApiList();
                        }).catch((err) => {
                            Swal.fire({
                                text: err,
                                icon: "error",
                                buttonsStyling: false,
                                confirmButtonText: "다시 확인하기",
                                customClass: {
                                    confirmButton: "btn btn-primary"
                                }
                            });
                        });
                    }
                });
            });
        }
    }

    var fn_botAddEvent = function(e){
        let bots = document.querySelectorAll('#botList label');
        for(let i = 0; i < bots.length; i++){
            bots[i].addEventListener('click',(e)=>{
                for(let j = 0; j<bots.length; j++){
                    bots[j].classList.remove('active');
                }
                document.getElementById("selectBotName").innerHTML = e.target.closest('label').querySelector('.bot-name').innerHTML;
                e.target.closest('label').querySelector('input[name=bot-check]').checked = true;
            });
            
            bots[i].querySelector('a[data-action=btn-bot-delete]').addEventListener('click',(event)=>{
                Swal.fire({
                    html: '<strong class="fs-4">Bot 삭제 확인</strong><br /><span class="fs-6">선택하신 Bot 을 삭제하시겠습니까?</span>',
                    icon: "error",
                    buttonsStyling: false,
                    showCancelButton: true,
                    confirmButtonText: '<a class="text-white">삭제</a>',
                    cancelButtonText: '<a class="text-gray-500">취소</a>',
                    customClass: {
                        confirmButton: "btn btn-danger px-5 py-2",
                        cancelButton: "btn btn-light px-5 py-2"
                    }
                }).then(ev => {
                    if(ev.isConfirmed){
                        let url = "./bot/botRm";
                        let formData = new FormData();
                        formData.append("bot_no", bots[i].dataset.botNo);
                        formData.append("csrfmiddlewaretoken",Cookies("csrftoken"));

                        fetch(url, {
                            method: "POST",
                            cache: 'no-cache',
                            body: formData,
                        }).then((response) => {
                            if (!response.ok || response.status != '200') {
                                throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
                            }
                        }).then((res) => {
                            fn_getBotList();
                        }).catch((err) => {
                            Swal.fire({
                                text: err,
                                icon: "error",
                                buttonsStyling: false,
                                confirmButtonText: "다시 확인하기",
                                customClass: {
                                    confirmButton: "btn btn-primary"
                                }
                            });
                        });
                    }
                });
            });
        }
    }

    var fn_cancleSelect = function() {
        document.getElementById("selectApiName").innerHTML = "";
        document.getElementById("selectBotName").innerHTML = "";
        let apiLabels = document.querySelectorAll('#apiList label');
        for(let i = 0; i<apiLabels.length; i++){
            apiLabels[i].classList.remove('active');
            apiLabels[i].querySelector('input[name=api_select]').checked = false;
        }
        let botLabels = document.querySelectorAll('#botList label');
        for(let i = 0; i<botLabels.length; i++){
            botLabels[i].classList.remove('active');
            botLabels[i].querySelector('input[name=bot-check]').checked = false;
        }
        document.querySelector("#kt_content .btn").blur();
    }

    var fn_setBtoMessageData = function() {
        let modal = document.getElementById('modal_bot_message_confirm');
        let selectApi = document.querySelector('#apiList input[name=api_select]:checked');
        let selectBot = document.querySelector('#botList input[name=bot-check]:checked');

        if(selectApi == null || selectBot == null){
            let message = "API 를";
            if(selectApi != null){
                message = "Bot 을"
            }
            Swal.fire({
                html: '<strong class="fs-4">Bot Message 전달</strong><br /><span class="fs-6">전달할 ' + message + ' 선택해주세요.</span>',
                icon: "error",
                buttonsStyling: false,
                showCancelButton: false,
                confirmButtonText: '<a class="text-white">확인</a>',
                customClass: {
                    confirmButton: "btn btn-primary px-5 py-2"
                }
            }).then(e=>{
                modalClose();
            });
        }

        if(selectApi != null){
            let apiName = selectApi.closest('label').querySelector('div.api-name').innerHTML;
            let apiClient = selectApi.closest('label').querySelector('div.client-id').innerHTML;
            modal.querySelector('div.api-name').innerHTML = apiName;
            modal.querySelector('div.client-id').innerHTML = apiClient;
            modal.querySelector('input[name=api_no]').value = selectApi.closest('label').dataset.apiNo;
        }else{
            modal.querySelector('div.api-name').innerHTML = "";
            modal.querySelector('div.client-id').innerHTML = "";
        }
        if(selectBot != null){
            let botName = selectBot.closest('label').querySelector('div.bot-name').innerHTML;
            let botId = selectBot.closest('label').querySelector('div.bot-id').innerHTML;
            modal.querySelector('div.bot-name').innerHTML = botName;
            modal.querySelector('div.bot-id').innerHTML = botId;
            modal.querySelector('input[name=bot_no]').value = selectBot.closest('label').dataset.botNo;
        }else{
            modal.querySelector('div.bot-name').innerHTML = "";
            modal.querySelector('div.bot-id').innerHTML = "";
        }
    }
</script>
{% endblock %}