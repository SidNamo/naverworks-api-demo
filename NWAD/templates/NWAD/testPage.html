{% load static %}
<!DOCTYPE html>
<html lang="ko">
    <!--begin::Head-->
    <head>
    </head>
    <!--end::Head-->
    <!--begin::Body-->
    <body>
        <textarea id="text1" style="width:500px;height:300px;" oninput="document.getElementById('l1').innerHTML = this.value.length;"></textarea>
        <div>length : <span id="l1"></span></div>
        <br/>
        <button type="button" id="btn1" onclick="send('enc');">암호화</button>
        <button type="button" id="btn2" onclick="send('dec');">복호화</button>
        <button type="button" id="btn1" onclick="send('sha');">sha</button>
        <button type="button" id="btn2" onclick="document.getElementById('text1').value =document.getElementById('text2').value">이동</button>
        <br/>
        <textarea id="text2" style="width:500px;height:300px;" readonly></textarea>
        <div>length : <span id="l2"></span></div>
    </body>
    <!--end::Body-->
    <script>
        var send = function(type) {
            let text = document.getElementById('text1').value;
            
            let formData = new FormData();
            formData.append("type", type);
            formData.append("text", text);
		    formData.append("csrfmiddlewaretoken", Cookies("csrftoken"));

            let url = "./testPage";

            fetch(url, {
                method: "POST",
                cache: 'no-cache',
                body: formData,
            }).then((response) => {
                if (!response.ok || response.status != '200') {
                    throw new Error('연결 실패. 다시 요청하세요.\n' + response.statusText + "(" + response.status + ")");
                }
                return response.json();
            }).then((res) => {
                document.getElementById('text2').value = res.text2;
                document.getElementById('l2').innerHTML = res.text2.length;
            }).catch((err) => {
                alert(err)
            });

        }

        //===========================================================================================
        //쿠키
        //===========================================================================================
        var Cookies = function (name, value, expire) {
            if (typeof value != "undefined" && typeof expire != "undefined") {
                var day = new Date();
                day.setDate(day.getDate() + expire);
                document.cookie = name + "=" + escape(value) + "; path=/; expires=" + day.toGMTString() + ";";
            } else {
                var org = document.cookie;
                var dlm = name + "=";
                var x = 0;
                var y = 0;
                var z = 0;

                while (x <= org.length) {
                    y = x + dlm.length;

                    if (org.substring(x, y) == dlm) {
                        if ((z = org.indexOf(";", y)) == -1) {
                            z = org.length;
                        }

                        return org.substring(y, z);
                    }

                    x = org.indexOf(" ", x) + 1;

                    if (x == 0) {
                        break;
                    }
                }

                return "";
            }
        }
    </script>
</html>